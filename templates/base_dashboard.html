<!-- templates/base_dashboard.html - FULL SCREEN LAYOUT -->
{% extends "base.html" %}
{% block title %}{{ title|default('Dashboard') }}{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title|default('Dashboard') }}</title>
    <!-- Fullscreen CSS -->
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            /* Prevent horizontal overflow while allowing vertical scroll */
            overflow-x: hidden;
            overflow-y: auto;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Poppins', sans-serif;
        }
        #wrapper {
            display: flex;
            height: 100vh;
            /* Avoid 100vw to prevent scrollbar-related horizontal overflow */
            width: 100%;
        }
        .sidebar {
            width: 280px;
            min-width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(0,0,0,0.1);
            overflow-y: auto;
            transition: all 0.3s ease;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }
        #wrapper.toggled .sidebar {
            margin-left: -280px;
        }
        #page-content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            /* Let content size shrink properly in flex layout and avoid clipping */
            min-width: 0;
            overflow-x: hidden;
        }
        .top-nav {
            height: 70px;
            background: rgba(255, 255, 255, 0.98);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            padding: 0 1.5rem;
            z-index: 1000;
        }
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            background: rgba(248, 249, 252, 0.95);
        }
        .container-fluid {
            max-width: none !important;
            padding: 0 1rem !important;
        }
        /* Fullscreen Cards */
        .card {
            border: none;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            height: 100%;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .card-header {
            border-radius: 16px 16px 0 0 !important;
            padding: 1rem 1.5rem;
            font-weight: 600;
        }
        /* Fullscreen Table */
        .table-responsive {
            border-radius: 16px;
            overflow: hidden;
        }
        /* Ensure rows wrap and avoid horizontal overflow */
        .row {
            margin: 0 !important;
            flex-wrap: wrap;
        }
        .col, .col-* {
            padding: 0.75rem !important;
        }
        /* Fullscreen Buttons */
        .btn {
            border-radius: 12px;
            padding: 0.5rem 1rem;
            font-weight: 600;
        }
        /* Hide scrollbars but keep functionality */
        .main-content::-webkit-scrollbar {
            width: 8px;
        }
        .main-content::-webkit-scrollbar-track {
            background: transparent;
        }
        .main-content::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        /* Sidebar behavior on small screens */
        @media (max-width: 992px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                transform: translateX(-100%);
                z-index: 1040;
                width: 260px;
                min-width: 260px;
            }
            #wrapper.toggled .sidebar {
                margin-left: 0;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body>
<div class="d-flex" id="wrapper">
    <!-- SIDEBAR -->
    <div class="sidebar" id="sidebar-wrapper">
        <div class="sidebar-heading text-center py-4 border-bottom">
            <h5 class="mb-0 text-primary font-weight-bold">
                <i class="fas fa-building mr-2"></i> EMS Pro
            </h5>
        </div>
        <div class="list-group list-group-flush">
            {% set nav_items = [
                ('dashboard', 'Dashboard', 'fa-tachometer-alt', url_for('admin_dashboard') if current_user.role=='admin' else url_for('supervisor_dashboard') if current_user.role=='supervisor' else url_for('employee_dashboard')),
                ('team', 'Team Management', 'fa-users-cog', url_for('supervisor_team_list')) if current_user.role in ['admin', 'supervisor'] else None,
                ('leaves', 'Leave Management', 'fa-calendar-alt', '#'),
                ('tasks', 'Tasks', 'fa-tasks', url_for('supervisor_team_list')) if current_user.role in ['admin', 'supervisor'] else None,
                ('attendance', 'Attendance', 'fa-clock', '#'),
                ('payroll', 'Payroll', 'fa-dollar-sign', '#'),
                ('announcements', 'Announcements', 'fa-bullhorn', '#')
            ] %}
            {% for key, label, icon, url in nav_items if url %}
            <a href="{{ url }}" class="list-group-item list-group-item-action {% if active==key %}active bg-primary text-white{% endif %}">
                <i class="fas {{ icon }} mr-3"></i>{{ label }}
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- PAGE CONTENT -->
    <div id="page-content-wrapper">
        <!-- TOP NAV -->
        <nav class="top-nav d-flex align-items-center">
            <button class="btn btn-link text-dark p-2" id="menu-toggle">
                <i class="fas fa-bars fa-lg"></i>
            </button>
            <div class="ml-auto d-flex align-items-center">
                {% if current_user.role in ['admin', 'supervisor'] %}
                <a href="{{ url_for('assign_task', emp_id=0) if current_user.role=='supervisor' else url_for('admin_users') }}" 
                   class="btn btn-success mr-3">
                    <i class="fas fa-plus mr-1"></i> Add New
                </a>
                {% endif %}
                <a href="{{ url_for('logout') }}" class="btn btn-danger mr-3">
                    <i class="fas fa-sign-out-alt mr-1"></i> Logout
                </a>
                <span class="badge badge-light mr-3">
                    <i class="far fa-calendar-alt mr-1"></i> {{ today }}
                </span>
                <div class="dropdown">
                    <img src="{{ current_user.profile_picture or url_for('static', filename='img/avatar.png') }}"
                         class="rounded-circle cursor-pointer" width="44" height="44" 
                         data-toggle="dropdown" alt="Profile">
                    <div class="dropdown-menu dropdown-menu-right">
                        <a class="dropdown-item" href="{{ url_for('employee_profile') if current_user.role=='employee' else url_for('admin_users') }}">
                            <i class="fas fa-user mr-2"></i> Profile
                        </a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item text-danger" href="{{ url_for('logout') }}">
                            <i class="fas fa-sign-out-alt mr-2"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="container-fluid">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                        <div class="alert alert-{{ 'success' if category=='success' else 'danger' if category=='danger' else 'warning' }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="close" data-dismiss="alert">Ã—</button>
                        </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                {% block dashboard_content %}{% endblock %}
            </div>
        </div>
    </div>
</div>

<!-- Fullscreen Scripts -->
<script>
    // Toggle sidebar
    document.getElementById('menu-toggle').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('wrapper').classList.toggle('toggled');
    });

    // Auto-expand on large screens
    window.addEventListener('load', function() {
        if (window.innerWidth > 992) {
            document.getElementById('wrapper').classList.remove('toggled');
        }
    });

    // Fullscreen on F11
    document.addEventListener('keydown', function(e) {
        if (e.key === 'F11') {
            e.preventDefault();
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
    });
</script>
</body>
</html>
{% endblock %}